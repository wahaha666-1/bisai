<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - AgentForge</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #f5f5f5;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .navbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar h1 {
            color: #667eea;
            font-size: 1.5em;
        }
        
        .user-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .admin-badge {
            background: #ff6b6b;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-secondary {
            background: #667eea;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5568d3;
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        /* æ ‡ç­¾é¡µ */
        .tabs {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-btn:hover {
            background: #f9f9f9;
        }
        
        .tab-content {
            padding: 20px;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* è¡¨æ ¼ */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f9f9f9;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        th {
            font-weight: 600;
            color: #333;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .role-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .role-admin {
            background: #fff3cd;
            color: #856404;
        }
        
        .role-user {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .action-btns {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 5px 15px;
            font-size: 0.9em;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar">
        <h1>ğŸ”§ ç®¡ç†åå°</h1>
        <div class="user-info">
            <span class="admin-badge">ğŸ‘‘ ç®¡ç†å‘˜</span>
            <span id="admin-name">{{ username }}</span>
            <a href="/workspace" class="btn btn-secondary">å·¥ä½œå°</a>
            <a href="/logout" class="btn btn-secondary">é€€å‡º</a>
        </div>
    </nav>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-value" id="total-users">0</div>
                <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ¤–</div>
                <div class="stat-value" id="total-agents">0</div>
                <div class="stat-label">æ€» Agent æ•°</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-value" id="total-workflows">0</div>
                <div class="stat-label">æ€»å·¥ä½œæµæ•°</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="total-executions">0</div>
                <div class="stat-label">æ€»æ‰§è¡Œæ¬¡æ•°</div>
            </div>
        </div>
        
        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('users')">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</button>
                <button class="tab-btn" onclick="switchTab('agents')">ğŸ¤– Agent ç®¡ç†</button>
                <button class="tab-btn" onclick="switchTab('workflows')">ğŸ”„ å·¥ä½œæµç®¡ç†</button>
                <button class="tab-btn" onclick="switchTab('logs')">ğŸ“‹ ç³»ç»Ÿæ—¥å¿—</button>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="tab-users" class="tab-content active">
                <h2>ç”¨æˆ·åˆ—è¡¨</h2>
                <table id="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>é‚®ç®±</th>
                            <th>è§’è‰²</th>
                            <th>çŠ¶æ€</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                            <th>æœ€åç™»å½•</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <tr><td colspan="7" class="empty-state">
                            <div class="empty-state-icon">â³</div>
                            <div>åŠ è½½ä¸­...</div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Agent ç®¡ç† -->
            <div id="tab-agents" class="tab-content">
                <h2>Agent åˆ—è¡¨</h2>
                <table id="agents-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>åç§°</th>
                            <th>ç±»å‹</th>
                            <th>ç‰ˆæœ¬æ•°</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody id="agents-tbody">
                        <tr><td colspan="5" class="empty-state">
                            <div class="empty-state-icon">â³</div>
                            <div>åŠ è½½ä¸­...</div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- å·¥ä½œæµç®¡ç† -->
            <div id="tab-workflows" class="tab-content">
                <h2>å·¥ä½œæµåˆ—è¡¨</h2>
                <table id="workflows-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>åç§°</th>
                            <th>Agent æ•°</th>
                            <th>æ‰§è¡Œæ¬¡æ•°</th>
                            <th>çŠ¶æ€</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody id="workflows-tbody">
                        <tr><td colspan="6" class="empty-state">
                            <div class="empty-state-icon">â³</div>
                            <div>åŠ è½½ä¸­...</div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div id="tab-logs" class="tab-content">
                <h2>æœ€è¿‘æ—¥å¿—</h2>
                <table id="logs-table">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>ç±»å‹</th>
                            <th>Agent/å·¥ä½œæµ</th>
                            <th>æ¶ˆæ¯</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="logs-tbody">
                        <tr><td colspan="5" class="empty-state">
                            <div class="empty-state-icon">â³</div>
                            <div>åŠ è½½ä¸­...</div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            // åŠ è½½æ•°æ®
            if (tabName === 'users') loadUsers();
            else if (tabName === 'agents') loadAgents();
            else if (tabName === 'workflows') loadWorkflows();
            else if (tabName === 'logs') loadLogs();
        }
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            try {
                // ç”¨æˆ·æ•°
                const usersResp = await fetch('/api/auth/users');
                if (usersResp.ok) {
                    const users = await usersResp.json();
                    document.getElementById('total-users').textContent = users.length;
                }
                
                // Agent æ•°
                const agentsResp = await fetch('/api/agents');
                if (agentsResp.ok) {
                    const agents = await agentsResp.json();
                    document.getElementById('total-agents').textContent = agents.length;
                }
                
                // å·¥ä½œæµæ•°
                const workflowsResp = await fetch('/api/workflows');
                if (workflowsResp.ok) {
                    const workflows = await workflowsResp.json();
                    document.getElementById('total-workflows').textContent = workflows.length;
                    
                    // æ€»æ‰§è¡Œæ¬¡æ•°
                    let totalExec = workflows.reduce((sum, w) => sum + (w.total_executions || 0), 0);
                    document.getElementById('total-executions').textContent = totalExec;
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥', error);
            }
        }
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers() {
            try {
                const response = await fetch('/api/auth/users');
                if (!response.ok) throw new Error('åŠ è½½å¤±è´¥');
                
                const users = await response.json();
                const tbody = document.getElementById('users-tbody');
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— ç”¨æˆ·</div></td></tr>';
                    return;
                }
                
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.id}</td>
                        <td><strong>${user.username}</strong></td>
                        <td>${user.email}</td>
                        <td><span class="role-badge role-${user.role}">${user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</span></td>
                        <td><span class="status-badge status-${user.is_active ? 'active' : 'inactive'}">${user.is_active ? 'æ´»è·ƒ' : 'åœç”¨'}</span></td>
                        <td>${user.created_date ? new Date(user.created_date).toLocaleString('zh-CN') : '-'}</td>
                        <td>${user.last_login ? new Date(user.last_login).toLocaleString('zh-CN') : 'ä»æœªç™»å½•'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥', error);
                document.getElementById('users-tbody').innerHTML = 
                    '<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">âŒ</div><div>åŠ è½½å¤±è´¥</div></td></tr>';
            }
        }
        
        // åŠ è½½ Agent åˆ—è¡¨
        async function loadAgents() {
            try {
                const response = await fetch('/api/agents');
                if (!response.ok) throw new Error('åŠ è½½å¤±è´¥');
                
                const agents = await response.json();
                const tbody = document.getElementById('agents-tbody');
                
                if (agents.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ—  Agent</div></td></tr>';
                    return;
                }
                
                tbody.innerHTML = agents.map(agent => `
                    <tr>
                        <td>${agent.id}</td>
                        <td><strong>${agent.name}</strong></td>
                        <td>${agent.agent_type}</td>
                        <td>${agent.version_count || 0}</td>
                        <td>${agent.created_date ? new Date(agent.created_date).toLocaleString('zh-CN') : '-'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½ Agent å¤±è´¥', error);
                document.getElementById('agents-tbody').innerHTML = 
                    '<tr><td colspan="5" class="empty-state"><div class="empty-state-icon">âŒ</div><div>åŠ è½½å¤±è´¥</div></td></tr>';
            }
        }
        
        // åŠ è½½å·¥ä½œæµåˆ—è¡¨
        async function loadWorkflows() {
            try {
                const response = await fetch('/api/workflows');
                if (!response.ok) throw new Error('åŠ è½½å¤±è´¥');
                
                const workflows = await response.json();
                const tbody = document.getElementById('workflows-tbody');
                
                if (workflows.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— å·¥ä½œæµ</div></td></tr>';
                    return;
                }
                
                tbody.innerHTML = workflows.map(workflow => `
                    <tr>
                        <td>${workflow.id}</td>
                        <td><strong>${workflow.name}</strong></td>
                        <td>${workflow.agent_count || 0}</td>
                        <td>${workflow.total_executions || 0}</td>
                        <td><span class="status-badge status-${workflow.status === 'active' ? 'active' : 'inactive'}">${workflow.status}</span></td>
                        <td>${workflow.created_date ? new Date(workflow.created_date).toLocaleString('zh-CN') : '-'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½å·¥ä½œæµå¤±è´¥', error);
                document.getElementById('workflows-tbody').innerHTML = 
                    '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon">âŒ</div><div>åŠ è½½å¤±è´¥</div></td></tr>';
            }
        }
        
        // åŠ è½½æ—¥å¿—
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs?limit=50');
                if (!response.ok) throw new Error('åŠ è½½å¤±è´¥');
                
                const logs = await response.json();
                const tbody = document.getElementById('logs-tbody');
                
                if (logs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— æ—¥å¿—</div></td></tr>';
                    return;
                }
                
                tbody.innerHTML = logs.map(log => `
                    <tr>
                        <td>${log.timestamp ? new Date(log.timestamp).toLocaleString('zh-CN') : '-'}</td>
                        <td>${log.type || '-'}</td>
                        <td>${log.agent_name || log.workflow_name || '-'}</td>
                        <td>${log.message || '-'}</td>
                        <td>${log.status || '-'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½æ—¥å¿—å¤±è´¥', error);
                document.getElementById('logs-tbody').innerHTML = 
                    '<tr><td colspan="5" class="empty-state"><div class="empty-state-icon">âŒ</div><div>åŠ è½½å¤±è´¥</div></td></tr>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            loadStats();
            loadUsers();
        };
    </script>
</body>
</html>


